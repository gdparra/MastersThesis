Nfft=512;
h=[1.00000000000000 + 0.00000000000000i	-0.0268443342716702 + 0.0666258311039275i	-0.0281337862268410 + 0.0343804559619977i	-0.0529003550292127 - 0.0330920256461915i	0.0879369822588708 - 0.130059472411140i	-0.213432810182887 - 0.108346284697459i	-0.117917224767330 - 0.0969197983189295i	0.0456735997146217 + 0.0371173326610425i	-0.0194177818592464 - 0.0479835687110798i	0.0179524708552702 + 0.0292883703921300i	0.112320500548770 + 0.141297280604463i	0.00823411398892111 + 0.0144799777202548i	-0.00758907846519582 - 0.0132892959822947i	0.00672777431042786 + 0.0119033513941179i	-0.00598556890430298 - 0.0107167232870459i	0.00537200253945009 + 0.00972674804966656i	-0.00486437469377788 - 0.00889673764145817i	0.00444034439283179 + 0.00819340188359676i	-0.00408213548602225 - 0.00759070795343295i	0.00377619853558881 + 0.00706883452440767i	-0.00351225566201245 - 0.00661266495199819i	0.00328245596578225 + 0.00621055476306264i	-0.00308073672229868 - 0.00585342270441037i	0.00290235986886120 + 0.00553409683075630i	-0.00274357847251461 - 0.00524684443765706i	0.00260139577194327 + 0.00498703144337770i	-0.00247338953393091 - 0.00475087277872130i	0.00235758261818801 + 0.00453524721238844i	-0.00225234649468847 - 0.00433755828128597i	0.00215632850110285 + 0.00415562860148141i	-0.00206839639277175 - 0.00398761863987650i	0.00198759562975330 + 0.00383196362267771i	-0.00191311614835383 - 0.00368732404448308i	0.00184426626961915 + 0.00355254648622866i	-0.00178045203228530 - 0.00342663232631282i	0.00172116068789031 + 0.00330871255298418i	-0.00166594741826734 - 0.00319802733515057i	0.00161442456905891 + 0.00309390933553392i	-0.00156625286350488 - 0.00299576999030092i	0.00152113418665426 + 0.00290308815760183i	-0.00147880562390141 - 0.00281540067102234i	0.00143903450816450 + 0.00273229443489324i	-0.00140161428335861 - 0.00265339977532247i	0.00136636103252627 + 0.00257838481988605i	-0.00133311055029954 - 0.00250695072461271i	0.00130171586362159 + 0.00243882760251613i	-0.00127204512357029 - 0.00237377103585521i	0.00124397980597402 + 0.00231155907635292i	-0.00121741317023883 - 0.00225198965511968i	0.00119224893512466 + 0.00219487833800415i	-0.00116840013765773 - 0.00214005637333343i	0.00114578814735126 + 0.00208736898806421i	-0.00112434181274518 - 0.00203667389572013i	0.00110399672120645 + 0.00198783998548933i	-0.00108469455613990 - 0.00194074616675108i	0.00106638253840019 + 0.00189528034734369i	-0.00104901294087058 - 0.00185133852720491i	0.00103254266698592 + 0.00180882399177399i	-0.00101693288549172 - 0.00176764659183876i	0.00100214871500559 + 0.00172772209841462i	-0.000988158953033303 - 0.00168897162284103i	0.000974935845021250 + 0.00165132109362130i	-0.000962454889835189 - 0.00161470078264993i	0.000950694678768210 + 0.00157904487441839i	-0.000939636765817964 - 0.00154429107258705i	0.000929265567557412 + 0.00151038023897362i	-0.000919568291470508 - 0.00147725606057734i	0.000910534892148806 + 0.00144486474072292i	-0.000902158055267509 - 0.00141315471080224i	0.000894433209789770 + 0.00138207635942033i	-0.000887358569406487 - 0.00135158177601008i	0.000880935204825356 + 0.00132162450620232i	-0.000875167149191927 - 0.00129215931639950i	0.000870061539689339 + 0.00126314196512789i	-0.000865628799246815 - 0.00123452897883538i	0.000861882863327537 + 0.00120627742985236i	-0.000858841458011212 - 0.00117834471425877i	0.000856526437090973 + 0.00115068832740081i	-0.000854964187744393 - 0.00112326563477392i	0.000854186116606945 + 0.00109603363594890i	-0.000854229230901215 - 0.00106894871917589i	0.000855136832815874 + 0.00104196640425607i	-0.000856959349805242 - 0.00101504107126536i	0.000859755329180143 + 0.000988125672757885i	-0.000863592632674475 - 0.000961171427235325i	0.000868549876129124 + 0.000934127492002171i	-0.000874718171764496 - 0.000906940614165264i	0.000882203246716112 + 0.000879554759635215i	-0.000891128032998411 - 0.000851910721841613i	0.000901635852823767 + 0.000823945714889312i	-0.000913894362084515 - 0.000795592960737743i	0.000928100467917706 + 0.000766781287715331i	-0.000944486509650818 - 0.000737434769979176i	0.000963328095036925 + 0.000707472457075718i	-0.000984954129061076 - 0.000676808273975886i	0.00100975978148584 + 0.000645351222150310i	-0.00103822344408065 - 0.000613006093699041i	0.00107092918066027 + 0.000579675044344562i	-0.00110859685629014 - 0.000545260594028004i	0.00115212318531856 + 0.000509671001750516i	-0.00120263859815374 - 0.000472829614752191i	0.00126158750905278 + 0.000434690948360881i	-0.00133084402216945 - 0.000395268353836954i	0.00141288274606885 + 0.000354682068028774i	-0.00151103793601983 - 0.000313244080700599i	0.00162990923179629 + 0.000271611717044754i	-0.00177602080616241 - 0.000231074670565044i	0.00195894021979774 + 0.000194114097252717i	-0.00219328121178802 - 0.000165550520679603i	0.00250253283782813 + 0.000155065030599853i	-0.00292702356727106 - 0.000183245366164568i	0.00354245328878727 + 0.000297903991755844i	-0.00451044539145236 - 0.000626133732150939i	0.00625520476917229 + 0.00158916587935662i	-0.0104446951033804 - 0.00532382261061605i	0.0479818434256466 + 0.0636599325744286i	-0.00351100702731225 + 0.0438808662156986i	-0.0485393965748511 + 0.0557997839015566i	0.0139240491224053 - 0.00533287509044444i	-0.0105833124228672 - 0.00176251352046418i	0.0147110647903569 + 0.0138595764355475i	0.00910511347597706 + 0.0243745887763024i	-0.000643160026558175 - 0.00811622848440922i	-0.000450396819333620 + 0.00501460710409755i	0.000727449531818060 - 0.00358488674662860i	-0.000775417892249928 + 0.00269056168880903i	0.000728690504411473 - 0.00201072645213045i	-0.000622416875531426 + 0.00139810096506294i	0.000452030139513080 - 0.000739600532128336i	-0.000172756205914260 - 0.000125500696111220i	-0.000365475132708432 + 0.00159466441093384i	0.00187647092882269 - 0.00544487452726181i	-0.0348991272213192 + 0.0870315153014966i	-0.00516006294208912 + 0.0116914403225407i	0.00316177783490256 - 0.00664781632796280i	-0.00256167596692988 + 0.00504733731065588i	0.00229195270014586 - 0.00425203553731536i	-0.00215659411932027 + 0.00377486925923575i	0.00209333090469712 - 0.00345850016767961i	-0.00207709580698934 + 0.00323678755782185i	0.00209688854863094 - 0.00307733935566119i	-0.00214839533296161 + 0.00296281424966540i	0.00223131669223367 - 0.00288362717802989i	-0.00234852341064045 + 0.00283479594780076i	0.00250620485556711 - 0.00281458746646968i	-0.00271489758368348 + 0.00282415120180199i	0.00299176298049178 - 0.00286795301951657i	-0.00336520283173852 + 0.00295527218733014i	0.00388459703366467 - 0.00310374616620511i	-0.00464286929208165 + 0.00334785775981835i	0.00583676132774465 - 0.00376181741872657i	-0.00796628823415636 + 0.00453547057858160i	0.0127822435521022 - 0.00633509109376934i];
Hk=fft(h,Nfft);
binsinmat=[90:256,258:422];
prk=zeros(1,512);
prk(binsinmat)=1;
gval=40;
gval=6.2005e-005;
Txp=1;
%Added CAZAC Sequence
p=23;
for n=0:(Nfft/4)-1
    cazac(n+1)=exp(-1i*(2*pi/(Nfft/4))*p*n^2/2);
end
%%%%%

%Calculate Gamma k
gamk=(Hk.*conj(Hk))*gval;
gamk(1)=0;
gamk(257)=0;

%Calculate Gamma 0
gam0=sum(prk(binsinmat))*(1+sum(prk(binsinmat)./gamk(binsinmat)))^(-1);
[atemp,bind]=find(gamk > gam0);

%Calculate Gamma 0P
gam0p=sum(prk(bind))*(1+sum(prk(bind)./gamk(bind)))^(-1);
gamk(bind);
[atemp,bind1]=find(gamk > gam0p);

%Calculate Gamma1P
gam1p=sum(prk(bind1))*(1+sum(prk(bind1)./gamk(bind1)))^(-1);
gamk(bind1);

%Calculate Power Gain
PowerGain=zeros(1,Nfft);
PowerGain(bind1)=(1/gam1p - 1./gamk(bind1))*1*(1/62);

%Plot Power Gain
plot(PowerGain)
title('Waterfilling Power Gain in Watts')
xlabel('Frequency Index')
ylabel('Power P(gamma_k)')

sumcap0=0;
sumcap1=0;
DF=15e3;
%variable transmit power capacity
for k=1:length(bind1)
sumcap0=sumcap0+DF*log2(gamk(bind1(k))/gam1p);
sumcap1=sumcap1+DF*log2(1+PowerGain(bind1(k))*gamk(bind1(k))/(1/5));
end

sumcap2=0;
DF=15e3;
%constant power capacity
for k=binsinmat %constant power capacity
sumcap2=sumcap2+DF*log2(1+gamk(k)/62);
end

%Power calculations

%Signal with no Gain (No Channel Vs Channel)

%No Channel

%With Channel
